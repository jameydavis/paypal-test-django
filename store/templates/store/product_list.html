{% load static %}
<!DOCTYPE html>
<html>
  <head>
    <title>Store</title>
    <script src="https://www.paypal.com/sdk/js?client-id={{ paypal_client_id }}&currency=USD"></script>
  </head>
  <body>
    <h1>Products</h1>
    {% for product in products %}
    <div class="product">
      <h2>{{ product.name }}</h2>
      <p>{{ product.description }}</p>
      <p>Price: ${{ product.price }}</p>
      <div id="paypal-button-{{ product.id }}"></div>
      <script>
        paypal
          .Buttons({
            createOrder: function (data, actions) {
              return actions.order.create({
                purchase_units: [
                  {
                    amount: {
                      value: "{{ product.price }}",
                    },
                  },
                ],
              });
            },
            onApprove: function (data, actions) {
              return actions.order.capture().then(function (details) {
                alert(
                  "Transaction completed by " + details.payer.name.given_name
                );
              });
            },
          })
          .render("#paypal-button-{{ product.id }}");
      </script>
    </div>
    {% endfor %}
  </body>
</html>
